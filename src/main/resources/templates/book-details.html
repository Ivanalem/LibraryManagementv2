<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${book.title} + ' | –î–µ—Ç–∞–ª–∏ –∫–Ω–∏–≥–∏'">–î–µ—Ç–∞–ª–∏ –∫–Ω–∏–≥–∏</title>
    <link rel="stylesheet" th:href="@{/style.css}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">

<!-- –ù–∞–≤–±–∞—Ä -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="/">üìö –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞</a>
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" th:href="@{/api/v1/index}">–ì–ª–∞–≤–Ω–∞—è</a></li>
            </ul>
        </div>
    </div>
</nav>

<!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
<div class="container my-5">
    <div class="card shadow">
        <div class="row g-0">
            <div class="col-md-8">
                <div class="card-body">
                    <h3 class="card-title" th:text="${book.title}">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏</h3>
                    <p class="card-text"><strong>–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:</strong> <span th:text="${book.description}"></span>
                    </p>
                    <p class="card-text"><strong>–ñ–∞–Ω—Ä:</strong> <span th:text="${book.genre}">–ñ–∞–Ω—Ä</span></p>
                    <p class="card-text"><strong>–ì–æ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:</strong> <span
                            th:text="${book.publishedYear}">2023</span></p>
                    <p class="card-text"><strong>–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–ø–∏–∏:</strong> <span
                            th:text="${book.availableCopies}">5</span></p>

                    <p class="card-text">
                        <strong>–ê–≤—Ç–æ—Ä—ã:</strong>
                    </p>
                    <div th:each="author, authorStat : ${book.authors}" class="mb-2">
                        <p class="mb-0">
                            <span th:text="${author.name}">–ò–º—è –ê–≤—Ç–æ—Ä–∞</span>
                            <span th:if="${!authorStat.last}">, </span>
                        </p>
                        <p class="text-muted"><strong>–ö—Ä–∞—Ç–∫–∞—è –±–∏–æ–≥—Ä–∞—Ñ–∏—è:</strong>
                            <span th:text="${author.biography}">–ë–∏–æ–≥—Ä–∞—Ñ–∏—è</span>
                        </p>
                    </div>

                    <div class="mt-4">
                        <!-- –ö–Ω–æ–ø–∫–∞ "–í–∑—è—Ç—å –∫–Ω–∏–≥—É" -->
                        <form th:action="@{/api/v1/borrow}" method="post" class="d-inline">
                            <input type="hidden" name="bookId" th:value="${book.id}"/>
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                            <button type="submit" class="btn btn-primary">üì• –í–∑—è—Ç—å –∫–Ω–∏–≥—É</button>
                        </form>
                        <!-- –ö–Ω–æ–ø–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫–Ω–∏–≥–∏, –µ—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è -->
                        <form th:if="${transaction != null}" th:action="@{/api/v1/transactions/return}" method="post">
                            <input type="hidden" name="transactionId" th:value="${transaction.id}"/>
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                            <button type="submit" class="btn btn-warning">üîÑ –í–µ—Ä–Ω—É—Ç—å –∫–Ω–∏–≥—É</button>
                        </form>

                        <!-- –ö–Ω–æ–ø–∫–∞ "–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤" -->
                        <a th:href="@{/api/v1/reviews/books/{bookId}/reviews(bookId=${book.id})}" class="btn btn-secondary ms-2">üí¨ –û—Å—Ç–∞–≤–∏—Ç—å
                            –æ—Ç–∑—ã–≤</a>

                        <li th:if="${#authorization.expression('hasRole(''ADMIN'')')}">
                            <form th:action="@{/api/v1/admin/books/delete/{id}(id=${book.id})}" method="post"
                                  onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –∫–Ω–∏–≥—É?');">
                                <button type="submit" class="btn btn-danger btn-sm mt-2">üóë –£–¥–∞–ª–∏—Ç—å</button>
                            </form>
                        </li>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –û—Ç–∑—ã–≤—ã -->
    <div class="mt-5">
        <h4>–û—Ç–∑—ã–≤—ã —á–∏—Ç–∞—Ç–µ–ª–µ–π:</h4>
        <div th:if="${#lists.isEmpty(reviews)}">
            <p class="text-muted">–û—Ç–∑—ã–≤–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
        </div>
        <div th:each="review : ${reviews}" class="card mb-3 shadow-sm">
            <div class="card-body">
                <h5 class="card-title" th:text="${review.user.username}">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h5>
                <p class="card-text">
                    <strong>–û—Ü–µ–Ω–∫–∞:</strong> <span th:text="${review.rating}">5</span>/5
                </p>
                <p class="card-text" th:text="${review.comment}">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</p>
                <p class="card-text"><small class="text-muted"
                                            th:text="${#dates.format(review.createdAt, 'dd.MM.yyyy')}">–î–∞—Ç–∞</small></p>
            </div>
            <!-- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É, –µ—Å–ª–∏ —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Äî –∞–≤—Ç–æ—Ä –æ—Ç–∑—ã–≤–∞ –∏–ª–∏ –∞–¥–º–∏–Ω -->
            <form th:action="@{/api/v1/reviews/reviews/{id}/delete(id=${review.id})}" method="post"
                  th:if="${#authentication.name == review.user.username or #authorization.expression('hasRole(''ROLE_ADMIN'')')}">
                <button type="submit" class="btn btn-danger btn-sm">üóë –£–¥–∞–ª–∏—Ç—å</button>
            </form>
        </div>
    </div>
</div>

<footer class="text-center py-4 bg-dark text-light mt-5">
    ¬© 2025 –í–∞—à–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ | –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã
</footer>

</body>
</html>
